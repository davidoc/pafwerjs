<!DOCTYPE html>
<html>
  <head>
    <title>Password generator</title>
    <script src="/js/crypto-sha256.js"></script>
    <script src="/js/wordlist.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min.js"></script>
    <script type="text/javascript">
      (function(exports, $) {
        var events_left = 100
          , buffer
          , random_2 = function(bits) {
              var hex = buffer.slice(0, Math.ceil(bits/4));
              buffer = Crypto.SHA256(buffer);
              return parseInt(hex, 16);
            };

        exports.random = function(max) {
          var bits = Math.ceil(Math.log(max)/Math.log(2))
          var n;

          do {
            n = random_2(bits);
          } while ( n >= max );
          return n;
        };

        exports.randomChoice = function(ary) {
          var index = exports.random(ary.length);
          return ary[index];
        };

        exports.randomPassword = function(n) {
          var words = []
          while ( n-- ) {
            words.push(exports.randomChoice(wordlist));
          }
          return words.join(" ");
        };

        exports.sentencePassword = function() {
          sentence = [];
          sentence.push(exports.randomChoice(words.adjectives));
          sentence.push(exports.randomChoice(words.nouns));
          sentence.push(exports.randomChoice(words.verbs));
          sentence.push(exports.randomChoice(words.adjectives));
          sentence.push(exports.randomChoice(words.nouns));
          return sentence.join(" ");
        }

        $(document).mousemove(function(event) {
          var x = event.clientX
            , y = event.clientY
            , ms = event.timeStamp;
          buffer = Crypto.SHA256(buffer + x + y + ms);
          events_left--;
          if ( ! events_left ) {
            $('#generate').show();
          }
        });


        $(document).ready(function() {
          $('#generate button').click(function() {
            $('#generate .password').text(exports.sentencePassword());
          });
        });
      })(window, jQuery);
    </script>
  </head>
  <body>
    <div id="generate" style="display: none;">
      <div class="password"></div>
      <button>Generate</button>
    </div>
  </body>
</html>
